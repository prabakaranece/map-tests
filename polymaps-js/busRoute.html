<!DOCTYPE HTML>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Busroute from CSV</title>
    <script src="js/polymaps.min.js" type="text/javascript"></script>
    <script src="js/jquery-1.7.min.js" type="text/javascript"></script>
    <script src="js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>
    <script src="js/date.js" type="text/javascript"></script>
    <link type="text/css" href="css/humanity/jquery-ui-1.8.16.custom.css" rel="Stylesheet" />
    <style type="text/css">
        *{
            margin: 0;
            padding: 0;
        }
        body,html{
            padding: 0;
            margin: 0;
        }
        path{
            fill: none;
            stroke-width: 4;
        }
        circle{
            fill: none;
        }
        #container{
            height: 100%;
        }
        #map {
            width: 79%;
            border: 1px solid #666;
            float: left;
            position: static;
        }
        #sidebar{
            width: 19%;
            margin: 0.5%;
            height: auto;
            float: left;
        }
  </style>

</head>
<body>
    <div id="container">
        <div id="sidebar">
            <h3>Chennai Conjestion Map</h3><p>Based on Bus Speed Data</p>
            <div id="slide-tip"></div>
            <div id="slider"></div>
        </div>
        <div id="map"></div>
    </div>
    <script type="text/javascript">
    // Map code
    var po = org.polymaps;
    // lat=13.01268&lon=80.236362&zoom=15
    // 13.098159,80.16945
    var map = po.map()
            .container(document.getElementById('map').appendChild(po.svg("svg")))
            .center({ lat: 13.16159, lon: 80.16945 })
            .zoom(12)
            .zoomRange([12,15])
            .add(po.interact());

    map.add(po.image()
        .url(po.url("http://{S}tile.cloudmade.com"
            + "/d2126e5f6bd740079852c1ee3a900d68"
            + "/998/256/{Z}/{X}/{Y}.png") 
        .hosts(["a.", "b.", "c.", ""])));


    function showPath(hour, previous){
        var layer = po.geoJson()
                .url("path.php?hour="+hour)
                .zoom(12)
                .tile(false)
                .on("load", po.stylist()
                        .attr("stroke", function(l){
                            if(l.properties.speed < 10){ return "black";}
                            else if ((l.properties.speed > 10) && (l.properties.speed < 20)){ return "red"}
                            else if ((l.properties.speed > 20) && (l.properties.speed < 30)){ return "yellow"}
                            else if (l.properties.speed > 30){ return "green"}
                            }));
        if (previous != undefined){
            map.remove(previous);
        }
        map.add(layer);
        return layer;
    }

    var nowShowing;
    // Slider Code
    $(function(){

            $(window).resize(function(){
                $("#map").height($(window).height() - 5);
                });

        $("#slider").slider({
                value:9,
                min: 0,
                max: 23,
                step: 1,
                slide: function(event, ui){
                    $("#slide-tip").html(ui.value);
                    nowShowing = showPath(ui.value, nowShowing);
                }
            });
        $("#slide-tip").html($("#slider").slider("value"));

        $('#map').height($(document).height()-5);

        });

    </script>
</body>
</html>
