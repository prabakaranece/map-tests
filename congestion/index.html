<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script type="text/javascript" src="js/jquery-1.6.2.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.8.16.custom.min.js">
    </script>
    <link type="text/css" href="css/humanity/jquery-ui-1.8.16.custom.css" rel="Stylesheet" />
    <link rel="stylesheet" href="leaflet/leaflet.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="leaflet/leaflet.ie.css" /><![endif]-->
    <script type="text/javascript" src="leaflet/leaflet.js"></script>
       <style type="text/css">
        *{
            margin: 0;
            padding: 0;
        }
        body,html{
            padding: 0;
            margin: 0;
            height: 100%;
        }
       h1,h2,h3,h4,h5,p,a,span{
            font-family: "Trebuchet MS",Verdana,Helvetica,Arial,sans-serif;
        }
        #container{
            height: 100%;
        }
        #map{
            width: 79%;
            border: 1px solid #666;
            float: left;
            height: 99%;
        }
        #sidebar{
            width: 19%;
            margin: 0.5%;
            height: auto;
            float: left;
        }
        </style>
            <script type="text/javascript">
            $(window).resize(function(){
                $("#map").height($(window).height() - 5);
            });
            </script>
</head>
<body>
    <div id="container">
        <div id="sidebar">
            <div id="top"><h3>Chennai Traffic Congestion Mapping</h3><p style="font-size: 90%;">Using the sample GPS log from MTC Buses</p></div>
            <div id="select">

            </div>
            <div class="ui-state-highlight ui-corner-all" style="margin-top: 10px; padding:10px;">
                <p style="font-size: 0.7em;"><span class="ui-icon ui-icon-info" style="float:left;"></span>
                This map has been created with a test data of the GPS Log data from the MTC [Metropolitan Transport Corporation (Chennai)]
                The background tiles are served using  <a href="http://www.cloudmade.com">Cloudmade</a> web application tiles. 
                This is written using the <a href="http://leaflet.cloudmade.com">LeafletJS</a> javascript library.
                </p>
            </div>
 
        </div>
        <div id="map"></div>
        <script type="text/javascript">
        /*
            var url2="path.php?";

            if(hour.toString().split(".").length > 1){url2 = url2+"hour="+Math.floor(hour)+"&min=30";}
            else{url2=url2+"hour="+hour+"&min=00";}
        */
/*
        $(function(){
            $(window).resize(function(){
                $("#map").height($(window).height() - 5);
            });
            $('#map').height($(document).height()-5);
        });
*/
        </script>
    </div>
    <script type="text/javascript">
        var map = new L.Map('map');

        var cloudUrl = "http://{s}.tile.cloudmade.com/d2126e5f6bd740079852c1ee3a900d68/22677/256/{z}/{x}/{y}.png",
        cloudAttr = 'Map tile data &copy; 2011 OpenStreetMap, Tiles &copy; 2011 CloudMade, Overlay Data: MTC Bus GPS Log Sample',
        cloudmade = new L.TileLayer(cloudUrl, {maxZoom: 15, attribution: cloudAttr});
       // 80.204895,13.069958 -104.98999178409576, 39.74683938093904
        var avadi = new L.LatLng(13.00, 80.204895);
        map.setView(avadi, 12).addLayer(cloudmade);

        var routesList = new Object;
        var files = new Array;

        $.getJSON("path.php?hour=9&min=30", function(routes){
                    $(routes).each(function(i,route){
                        var geo = route.geojson;
                    files.push(new L.GeoJSON());
                    files[i].on("featureparse", function(e){
                            // Styling
                            var color;
                            if(e.properties.speed < 10){ color = 'black'; }
                            else if (e.properties.speed > 10 && e.properties.speed < 20 ){color='red';}
                            else if (e.properties.speed > 20 && e.properties.speed < 30 ){color='yellow';}
                            else if (e.properties.speed > 30 ){color='green'}
                            e.layer.setStyle({"weight":5,
                                "color": color,
                                "opacity": 1});
                            // Popup
                            e.layer.bindPopup( e.properties.speed + " km/hr");
                            });
                    map.addLayer(files[i]);
                    files[i].addGeoJSON(geo);

                    routesList[route.trace_name] = files[i];

                        });

                    var layersControl = new L.Control.Layers(null, routesList);
                    map.addControl(layersControl);
        });

        
   </script>
</body>
</html>
